@Override
protected void doPost(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {

    response.setContentType("application/json;charset=UTF-8");
    String action = request.getParameter("action");

    try (PrintWriter out = response.getWriter()) {

        if ("toggleRestaurantStatus".equals(action)) {
            int restaurantId = Integer.parseInt(request.getParameter("restaurantId"));
            String status = request.getParameter("status");
            boolean updated = adminService.toggleRestaurantStatus(restaurantId, status);

            out.write("{\"success\":" + updated + "}");
            return; // âœ… prevent fall-through

        } else if ("deleteRestaurant".equals(action)) {
            int restaurantId = Integer.parseInt(request.getParameter("restaurantId"));
            boolean deleted = adminService.deleteRestaurant(restaurantId);

            out.write("{\"success\":" + deleted + "}");
            return; // âœ… prevent fall-through
        }

        // ðŸ§© NEW BLOCK for user toggle â€” isolated & safe
        else if ("toggleUserStatus".equals(action)) {
            int userId = Integer.parseInt(request.getParameter("userId"));
            String status = request.getParameter("status"); // e.g., "Active" or "Blocked"

            boolean success = adminService.toggleUserStatus(userId, status);

            Map<String, Object> result = new HashMap<>();
            result.put("success", success);
            result.put("message", success
                    ? (status.equalsIgnoreCase("Active") ? "User blocked successfully" : "User unblocked successfully")
                    : "Failed to update user status");

            out.write(new Gson().toJson(result));
            return; // âœ… ensures this response does not affect others
        }

        // Fallback for unknown actions
        else {
            response.setStatus(HttpServletResponse.SC_BAD_REQUEST);
            out.write("{\"error\":\"Unknown action\"}");
        }

    } catch (Exception e) {
        e.printStackTrace();
        response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
        response.getWriter().write("{\"error\":\"Server error occurred\"}");
    }
}